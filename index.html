<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel of Teams</title>
<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  background: #000;
  color: white;
  font-family: "Segoe UI", sans-serif;
  overflow: hidden;
}
.left-section {
  width: 50%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding-top: 60px;
}
#wheel-container { position: relative; width: 450px; height: 450px; }
#wheel {
  width: 450px; height: 450px; border-radius: 50%;
  transition: transform 6s cubic-bezier(0.25,0.1,0.25,1);
}
.pointer {
  position: absolute; top: 50%; left: -5px;
  transform: translateY(-50%) rotate(180deg);
  border-top: 15px solid transparent;
  border-bottom: 15px solid transparent;
  border-right: 30px solid yellow;
  z-index: 10;
}
#spinButton {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: radial-gradient(circle, #ffdd00, #ff9900);
  color: #000; font-weight: bold;
  border: none; border-radius: 50%;
  width: 110px; height: 110px;
  font-size: 18px; cursor: pointer; z-index: 20;
}
#popup {
  padding: 20px 50px; border-radius: 15px;
  font-size: 26px; font-weight: bold; margin-top: 30px;
  display: none; text-align: center; color: #fff;
}
.overlay-container {
  position: fixed; bottom: 0; left: 0; width: 100%;
  height: 30vh; background: rgba(0,51,153,0.85);
  display: flex; justify-content: space-around; align-items: center;
}
.group {
  background: rgba(255,255,255,0.95);
  border: 3px solid #333; border-radius: 10px;
  width: 180px; height: 185px; padding: 10px;
  text-align: center; color: #000;
}
.group h3 { margin: 5px 0 10px; font-size: 18px; color: #003399; }
.group table { width: 100%; border-collapse: collapse; }
.group td {
  border: 1px solid #000; padding: 5px;
  font-size: 14px; text-align: center;
  height: 25px; white-space: nowrap; overflow: hidden;
}
</style>
</head>
<body>

<div class="left-section">
  <div id="wheel-container">
    <canvas id="wheel" width="450" height="450"></canvas>
    <div class="pointer"></div>
    <button id="spinButton">SPIN</button>
  </div>
  <div id="popup">ðŸŽ¯ Siap diundi ðŸŽ¯</div>
</div>

<div class="overlay-container" id="overlayContainer"></div>

<script>
const wheel = document.getElementById("wheel");
const ctx = wheel.getContext("2d");
let teams = JSON.parse(localStorage.getItem("wheelTeams")) || [];
const groups = ["A","B","C","D"];
const colors = [
  "#f94144","#f3722c","#f8961e","#f9844a","#f9c74f",
  "#90be6d","#43aa8b","#577590","#277da1","#4cc9f0",
  "#b5179e","#7209b7","#480ca8","#3f37c9","#4361ee","#4895ef"
];
let currentGroupIndex = 0;
let rotation = 0;
let spinning = false;

// ================== DRAW WHEEL ==================
function drawWheel() {
  ctx.clearRect(0, 0, 450, 450);
  if (teams.length === 0) {
    ctx.fillStyle = "#fff";
    ctx.font = "bold 24px Segoe UI";
    ctx.textAlign = "center";
    ctx.fillText("Belum ada tim", 225, 225);
    return;
  }
  const segmentAngle = (2 * Math.PI) / teams.length;
  for (let i = 0; i < teams.length; i++) {
    const start = i * segmentAngle;
    ctx.beginPath();
    ctx.moveTo(225, 225);
    ctx.arc(225, 225, 225, start, start + segmentAngle);
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();
    ctx.save();
    ctx.translate(225, 225);
    ctx.rotate(start + segmentAngle / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 15px Segoe UI";
    ctx.fillText(teams[i], 210, 5);
    ctx.restore();
  }
}
drawWheel();

// ================== RENDER GRUP ==================
function getTeams(gr){ return JSON.parse(localStorage.getItem(`group${gr}`)) || ["","","",""]; }
function saveTeams(gr,arr){ localStorage.setItem(`group${gr}`,JSON.stringify(arr)); }
function renderGroups(){
  const container=document.getElementById("overlayContainer");
  container.innerHTML="";
  groups.forEach(gr=>{
    const t=getTeams(gr);
    const rows=t.map(x=>`<tr><td>${x||""}</td></tr>`).join("");
    container.innerHTML+=`<div class="group"><h3>GRUP ${gr}</h3><table>${rows}</table></div>`;
  });
}
renderGroups();

// ================== SPIN ==================
document.getElementById("spinButton").addEventListener("click",()=>{
  if(spinning||teams.length===0) return;
  spinning=true;
  const randomIndex=Math.floor(Math.random()*teams.length);
  const segmentAngle=360/teams.length;
  const stopAngle=360*5+(randomIndex*segmentAngle)+180+(Math.random()*10-5);
  rotation+=stopAngle;
  wheel.style.transform=`rotate(${rotation}deg)`;
  wheel.style.transition="transform 6s cubic-bezier(0.25,0.1,0.25,1)";
  setTimeout(()=>{
    const normalized=(rotation%360+360)%360;
    const index=Math.floor(((normalized-180+360)%360)/segmentAngle);
    const selectedIndex=teams.length-1-index;
    const selectedTeam=teams[selectedIndex]||teams[0];
    const color=colors[selectedIndex%colors.length];
    showPopup(selectedTeam,color);
    addTeamToGroup(selectedTeam);
    teams.splice(selectedIndex,1);
    drawWheel();
    spinning=false;
  },6200);
});

// ================== POPUP ==================
function showPopup(team,color){
  const popup=document.getElementById("popup");
  popup.textContent=`ðŸŽ‰ ${team} ðŸŽ‰`;
  popup.style.background=color;
  popup.style.display="block";
  popup.style.opacity="1";
  setTimeout(()=>popup.style.opacity="0",4500);
  setTimeout(()=>popup.style.display="none",5000);
}

// ================== ADD KE GRUP ==================
function addTeamToGroup(team){
  const group=groups[currentGroupIndex];
  let t=getTeams(group);
  const empty=t.findIndex(x=>x==="");
  if(empty!==-1){ t[empty]=team; saveTeams(group,t); }
  currentGroupIndex=(currentGroupIndex+1)%groups.length;
  renderGroups();
}
</script>
</body>
</html>
