<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel & Grup</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  margin: 0;
  background: #021027;
  color: #fff;
  overflow: hidden;
}

/* Wheel kiri */
#wheel-container {
  position: absolute;
  left: 5%;
  top: 50%;
  transform: translateY(-50%);
  width: 400px;
  height: 400px;
}

canvas#wheel {
  border-radius: 50%;
  transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Tombol SPIN */
#spinButton {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: radial-gradient(circle, #ffcc00, #ff9900);
  color: #000;
  font-weight: bold;
  border: none;
  border-radius: 50%;
  width: 100px;
  height: 100px;
  font-size: 20px;
  cursor: pointer;
  z-index: 5;
}

/* Panah kuning di kanan */
.pointer {
  position: absolute;
  top: 50%;
  right: -40px;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 20px solid transparent;
  border-bottom: 20px solid transparent;
  border-left: 40px solid yellow;
  z-index: 10;
}

/* Grup di bawah */
.overlay-container {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 25vh;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.group {
  background: rgba(0, 0, 0, 0.6);
  padding: 10px;
  border-radius: 10px;
  width: 170px;
  text-align: center;
}
.group h3 { margin-top: 0; color: #ff0; }
.group table { width: 100%; border-collapse: collapse; color: #fff; }
.group td {
  border: 1px solid #fff;
  height: 25px;
}
</style>
</head>
<body>

<div id="wheel-container">
  <canvas id="wheel" width="400" height="400"></canvas>
  <button id="spinButton">SPIN</button>
  <div class="pointer"></div>
</div>

<div class="overlay-container" id="overlayContainer">
  <div id="groupA" class="group"><h3>Grup A</h3><table><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table></div>
  <div id="groupB" class="group"><h3>Grup B</h3><table><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table></div>
  <div id="groupC" class="group"><h3>Grup C</h3><table><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table></div>
  <div id="groupD" class="group"><h3>Grup D</h3><table><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr></table></div>
</div>

<script>
const wheel = document.getElementById("wheel");
const ctx = wheel.getContext("2d");
const groups = ["A", "B", "C", "D"];
let teams = JSON.parse(localStorage.getItem("wheelTeams")) || [
  "Team A","Team B","Team C","Team D",
  "Team E","Team F","Team G","Team H"
];
let bg = localStorage.getItem("groupBackground");
let rotation = 0;
let spinning = false;
let currentGroupIndex = 0;
let currentPos = 3;

// Terapkan background dari localStorage
const overlay = document.getElementById("overlayContainer");
if (bg) overlay.style.backgroundImage = `url('${bg}')`;
else overlay.style.backgroundColor = "#003399";

// ================= DRAW WHEEL =================
function drawWheel() {
  ctx.clearRect(0, 0, 400, 400);
  const total = teams.length;
  if (total === 0) {
    ctx.fillStyle = "#fff";
    ctx.font = "bold 20px Segoe UI";
    ctx.textAlign = "center";
    ctx.fillText("Tidak ada tim", 200, 200);
    return;
  }
  const angle = (2 * Math.PI) / total;
  for (let i = 0; i < total; i++) {
    const start = i * angle;
    const end = start + angle;
    ctx.beginPath();
    ctx.moveTo(200, 200);
    ctx.arc(200, 200, 200, start, end);
    ctx.fillStyle = `hsl(${i * (360 / total)}, 70%, 50%)`;
    ctx.fill();
    ctx.save();
    ctx.translate(200, 200);
    ctx.rotate(start + angle / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "16px Segoe UI";
    ctx.fillText(teams[i], 180, 5);
    ctx.restore();
  }
}
drawWheel();

// ================= SPIN =================
document.getElementById("spinButton").addEventListener("click", () => {
  if (spinning || teams.length === 0) return;
  spinning = true;

  const segmentAngle = 360 / teams.length;
  const randomIndex = Math.floor(Math.random() * teams.length);
  const stopAngle = 360 * 5 + randomIndex * segmentAngle + (Math.random() * 10 - 5);
  rotation += stopAngle;
  wheel.style.transform = `rotate(${rotation}deg)`;
  wheel.style.transition = "transform 6s cubic-bezier(0.25, 0.1, 0.25, 1)`;

  setTimeout(() => {
    const normalized = (rotation % 360 + 360) % 360;

    // âœ… Hitung arah berdasarkan panah kanan (0 derajat)
    const index = Math.floor(((normalized) % 360) / segmentAngle);
    const selectedTeam = teams[(teams.length - index - 1 + teams.length) % teams.length];

    alert("ðŸŽ¯ Tim Terpilih: " + selectedTeam);
    addTeamToGroup(selectedTeam);

    teams.splice(teams.indexOf(selectedTeam), 1);
    drawWheel();
    spinning = false;
  }, 6200);
});

// ================= ADD TEAM TO GROUP =================
function addTeamToGroup(team) {
  const group = groups[currentGroupIndex];
  const groupTable = document.querySelector(`#group${group} table`);
  const rows = groupTable.querySelectorAll("tr");
  rows[currentPos].children[0].textContent = team;

  // Simpan ke localStorage
  let saved = JSON.parse(localStorage.getItem(`group${group}`)) || ["", "", "", ""];
  saved[currentPos] = team;
  localStorage.setItem(`group${group}`, JSON.stringify(saved));

  // Ganti grup & posisi
  currentGroupIndex = (currentGroupIndex + 1) % groups.length;
  if (currentGroupIndex === 0) currentPos--;
  if (currentPos < 0) currentPos = 0;
}
</script>
</body>
</html>
